{"id":"alternative_timestamps","script":"//* TITLE Alternative Timestamps **//\r\n//* VERSION 1.0 REV G **//\r\n//* DESCRIPTION Adds timestamps to dashboard posts using a parsing method instead of AJAX calls. English tumblr interface only for now. **//\r\n//* DEVELOPER Bit Shift **//\r\n//* FRAME false **//\r\n//* BETA true **//\r\n\r\nXKit.extensions.alternative_timestamps = new Object({\r\n\r\n\trunning: false,\r\n\r\n\tdays_regex: /(Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)/i,\r\n\tyear_regex: /([1-9][0-9]*)\\,/,\r\n\r\n\tpreferences: {\r\n\t\tformat_string: {\r\n\t\t\ttext: 'Format string',\r\n\t\t\ttype: 'text',\r\n\t\t\tdefault: 'YYYY-MM-DD HH:mm :: RR'\r\n\t\t},\r\n\t\tformat_syntax_header: {\r\n\t\t\ttext: 'Format string syntax',\r\n\t\t\ttype: 'separator'\r\n\t\t}\r\n\t},\r\n\r\n\trun: function() {\r\n\t\tthis.running = true;\r\n\t\tXKit.tools.init_css('alternative_timestamps');\r\n\r\n\t\tXKit.post_listener.add('alternative_timestamps_insert', this.insert_timestamps);\r\n\r\n\t\tthis.insert_timestamps();\r\n\t},\r\n\r\n\tinsert_timestamps: function() {\r\n\t\t$('#posts .post.with_permalink').add('#inboxposts .post.with_permalink').not('.alternative_timestamp_done').each(function(index) {\r\n\t\t\t$(this).addClass('alternative_timestamp_done');\r\n\r\n\t\t\tvar moment_timestamp = XKit.extensions.alternative_timestamps.parse_timestamp($(this));\r\n\r\n\t\t\tif(moment_timestamp !== null) {\r\n\t\t\t\tvar post_id = $(this).attr('id').replace('post_', '');\r\n\r\n\t\t\t\tvar $timestamp = $('<div>');\r\n\t\t\t\t$timestamp.attr('id', 'alternative_timestamp_' + post_id);\r\n\t\t\t\t$timestamp.addClass('alternative_timestamp');\r\n\t\t\t\t$timestamp.text(XKit.extensions.alternative_timestamps.render_timestamp(moment_timestamp));\r\n\r\n\t\t\t\t$(this).find('.post_info').first().append($timestamp);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tremove_timestamps: function() {\r\n\t\t$('.alternative_timestamp_done').removeClass('alternative_timestamp_done');\r\n\t\t$('.alternative_timestamp').remove();\r\n\t},\r\n\r\n\tstrip_ordinals: function(date_string) {\r\n\t\treturn date_string.replace(/([0-9])(?:st|nd|rd|th)/i, \"$1\");\r\n\t},\r\n\r\n\tparse_timestamp: function($post) {\r\n\t\tvar permalink_title = $post.find('.post_permalink').attr('title');\r\n\t\tif(permalink_title.indexOf('-') < 0) { return null; }\r\n\r\n\t\tvar permalink_time = permalink_title.slice(permalink_title.indexOf('-') + 2);\r\n\r\n\t\tvar moment_post_time = moment(); // wrong, but next it's refined\r\n\r\n\t\tif(permalink_time.match(this.days_regex) !== null) {\r\n\t\t\t// \"{day of week}, {time}\"\r\n\r\n\t\t\tvar day_name = permalink_time.match(this.days_regex)[1];\r\n\t\t\tvar _permalink_time = permalink_time.replace(this.days_regex, \"\");\r\n\t\t\tvar moment_permalink_time = moment(_permalink_time, 'h:mma');\r\n\r\n\t\t\tmoment_post_time.hours(moment_permalink_time.hours());\r\n\t\t\tmoment_post_time.minutes(moment_permalink_time.minutes());\r\n\r\n\t\t\twhile(moment_post_time.format(\"dddd\") !== day_name) {\r\n\t\t\t\tmoment_post_time.subtract(moment.duration(1, 'days'));\r\n\t\t\t}\r\n\t\t} else if(permalink_time.match(',') === null) {\r\n\t\t\t// \"{time}\"\r\n\r\n\t\t\tvar moment_permalink_time = moment(permalink_time, 'h:mma');\r\n\r\n\t\t\tmoment_post_time.hours(moment_permalink_time.hours());\r\n\t\t\tmoment_post_time.minutes(moment_permalink_time.minutes());\r\n\t\t} else if(permalink_time.match(this.year_regex) === null) {\r\n\t\t\t// \"{month} {day}{ordinal}, {time}\"\r\n\r\n\t\t\tvar _permalink_time = this.strip_ordinals(permalink_time);\r\n\t\t\tvar moment_permalink_time = moment(_permalink_time, 'MMM D, h:mma');\r\n\r\n\t\t\tmoment_post_time.month(moment_permalink_time.month());\r\n\t\t\tmoment_post_time.date(moment_permalink_time.date());\r\n\t\t\tmoment_post_time.hours(moment_permalink_time.hours());\r\n\t\t\tmoment_post_time.minutes(moment_permalink_time.minutes());\r\n\t\t} else {\r\n\t\t\t// \"{month} {day}{ordinal} {year}, {time}\"\r\n\r\n\t\t\tvar _permalink_time = this.strip_ordinals(permalink_time);\r\n\t\t\tvar moment_permalink_time = moment(_permalink_time, 'MMM D YYYY, h:mma');\r\n\r\n\t\t\tmoment_post_time.year(moment_permalink_time.year());\r\n\t\t\tmoment_post_time.month(moment_permalink_time.month());\r\n\t\t\tmoment_post_time.date(moment_permalink_time.date());\r\n\t\t\tmoment_post_time.hours(moment_permalink_time.hours());\r\n\t\t\tmoment_post_time.minutes(moment_permalink_time.minutes());\r\n\t\t}\r\n\r\n\t\treturn moment_post_time;\r\n\t},\r\n\r\n\trender_timestamp: function(moment_timestamp, format_string) {\r\n\t\tformat_string = format_string || this.preferences.format_string.value;\r\n\r\n\t\tformat_string = format_string.replace(/\\[(.*)\\]/g, this.escape_raw);\r\n                format_string = format_string.replace(/RR/g, this.escape_raw(null, moment_timestamp.fromNow()));\r\n\r\n\t\treturn moment_timestamp.format(format_string);\r\n\t},\r\n\r\n\tescape_raw: function(full_match, raw_block) {\r\n\t\treturn raw_block.replace(/./g, function(c) {\r\n\t\t\treturn '\\\\' + c;\r\n\t\t});\r\n\t},\r\n\r\n\tdestroy: function() {\r\n\t\tthis.running = false;\r\n\t\tXKit.tools.remove_css('alternative_timestamps');\r\n\r\n\t\tXKit.post_listener.remove('alternative_timestamps_insert');\r\n\r\n\t\tthis.remove_timestamps();\r\n\t},\r\n\r\n\tcpanel: function($panel) {\r\n\t\t$.each(this.format_syntax, function(code, description) {\r\n\t\t\tvar $syntax_line = $('<div>');\r\n\t\t\t$syntax_line.addClass('xkit-extension-setting');\r\n\t\t\t$syntax_line.append($('<div>').addClass('title').text(code));\r\n\t\t\t$syntax_line.append($('<div>').text(description));\r\n\t\t\t$syntax_line.append($('<div>').addClass('alternative_timestamps_preview').text(XKit.extensions.alternative_timestamps.render_timestamp(moment(), code)));\r\n\r\n\t\t\t$panel.append($syntax_line);\r\n\t\t});\r\n\t},\r\n\r\n\tformat_syntax: {\r\n\t\t'[text]': 'Raw text block',\r\n\t\t'RR': 'Relative timestamp',\r\n\t\t'M': 'Month number',\r\n\t\t'Mo': 'Month number with ordinal',\r\n\t\t'MM': 'Month number with leading 0',\r\n\t\t'MMM': 'Month name, short',\r\n\t\t'MMMM': 'Month name, full',\r\n\t\t'D': 'Day of month number',\r\n\t\t'Do': 'Day of month number with ordinal',\r\n\t\t'DD': 'Day of month number with leading 0',\r\n\t\t'DDD': 'Day of year number',\r\n\t\t'DDDo': 'Day of year number with ordinal',\r\n\t\t'DDDD': 'Day of year number with leading 0s',\r\n\t\t'd': 'Day of week number',\r\n\t\t'do': 'Day of week number with ordinal',\r\n\t\t'ddd': 'Day of week name, short',\r\n\t\t'dddd': 'Day of week name, full',\r\n\t\t'w': 'Week of year number',\r\n\t\t'wo': 'Week of year number with ordinal',\r\n\t\t'ww': 'Week of year number with leading 0',\r\n\t\t'YY': 'Year without centuries',\r\n\t\t'YYYY': 'Year with centuries',\r\n\t\t'a': 'am/pm',\r\n\t\t'A': 'AM/PM',\r\n\t\t'H': 'Hour, 24-hour time',\r\n\t\t'HH': 'Hour with leading 0, 24-hour time',\r\n\t\t'h': 'Hour, 12-hour time',\r\n\t\t'hh': 'Hour with leading 0, 12-hour time',\r\n\t\t'm': 'Minute',\r\n\t\t'mm': 'Minute with leading 0'\r\n\t}\r\n});","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NUZGMTQ1NkZFNzlGMTFFMjhFRkZERjhBQUIzN0M3RUYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NUZGMTQ1NzBFNzlGMTFFMjhFRkZERjhBQUIzN0M3RUYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo1RkYxNDU2REU3OUYxMUUyOEVGRkRGOEFBQjM3QzdFRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo1RkYxNDU2RUU3OUYxMUUyOEVGRkRGOEFBQjM3QzdFRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pp4tly4AAAU8SURBVHjatJZHT1xJEIA9mGRyzhjwDmCChkEIMEIEEQUXECBASBwQWP4dyPLJRy4c9sIFEfYAF4KEYMlCiJzTwpJzHDKM92P67TAegi0jlwTT73XXV9X1qqpbNjc39+q3ybdv3wz5W15efmqFSqVidmNjY3t7++Dg4PT0lJfm5ua2trZOTk6urq5v3761sLB4Sp1ZQ35kMtnDuZ2dnampqZmZGdB6U4caWVxcZIwZf3//gIAAR0fHR23c7eChgYGBgaGhIRxnjKaTRvDaysqKN8fHx+xmWyNbGiHOoaGhYWFhj4SIHwMDA92YdHd39/T0MPbw8PD19VUqlTY2NoTlzZs3RkZGvL++vj4/Pydc7GN4eBj66urq2tra/v5+dHS0XsS+2wH0tra2/v5+cOw6NjbWzc3NwcGBR9CGhobgWIbJm5sbzGCDBevr6x0dHcQTz66urhISErQ2vtsBD11dXX19ffgbHh4eHx/v7u5ubW1tamqq3aIYvNaIiYmJmZmZpaWlnZ0d0WMlnqFubGyclpamdfpuB0Ktt7e3vb0dZyMiIpKTk6GjjNdMqdVqsTokJET3EcE8a4w1ArSzsxOIvb19VFSUcNpAhIgPhXHGCoUiKSmJ6EPHsPpHcnFxUV5efnl56eLigiLqQEABBCsZADQyMkK+e3l5paSkkN3sQ0w/L3BLS0ubmpq+fv16e3tLpqEOBBRAsHdwNnJycsIz7mAf34ksE7c/EhIJ+tjYGN7ExcUdHR0RJdSBgAIIVtrB/Pz8ysoKeyTJfj4ynz9/Hh8fh56Tk4PvfHM+BupAQAEEKxlYWlpCh7Imf0jHn6F/+fJlYmICenZ2NulAMVKDeIY6EFAsAytlESHj2dvbm1LSSxJdWZmZmRsZoQL+7u//Z2ODSEKnDnAfKO6DYhkQUGQ8WKkONjc3gXp6epLdz9Cn/yz3vlL9Ozuu3j8z+yMoKyuLUECnAgRdGAACCg5YqZvSWHimYskcWhArgoKCWFpYWHjfVba2CmX75j6+9mqVt/rI6d07kk1ERuvW9PQ0/+VyOSjegJUMiMiyTpSGeHy4iY3D7ZPBbZX61ZW5I6ULRc93rZYwKR7vpllHX9zb22NrwncxV1ZWRkMl2xjvkRZ1fx2uzp7KjAzlgYoPH/ToiJ+fn9AFxX8WSDsglMSLbwJd9AYhpAQhptUwpnz4nnwJFsgVCje5XGTzw42SBSJrwEoG+OiDg4MLCwv0Qt3WzZhU0T5aKZV+SqVur9f6ritAQIm0lAy8f/+eZw4vSl90/JcIEFAAwUqFRo/08fHh3KARskH1CwR1IKAAgpV6EYGOiYlhmnOD4/D2BYI6EFAAwd5308TERE5HvkRdXR1H1a+5jyLqQEABFJ9TMkB1ZGZmsqixsbGlpeUXAoUKiqgzBiXXpBnw1x8/fqRqqOHAwEDOWM41Mp5+QsPSpopWSA9OdjqP3nuC09raWltbyzlD/ZeUlECHya3g/shEioqKzs7OampqKioqKL2MjAxORN0MEYmvl/401/r6enynvnJzc4GIpiBVdXFxMUeoTCO03+DgYExybRkdHeVqxZjy1m7FRiO6jpMzlZWV0PEM9KdPn2hQsv+F7cpgcTXTuy1VVVVVV1fT8VnE/YXoEVMsiesblz5xnkxOTnJbYT0tIC8vLz8/X+8OR0HcGQDxsF5mZ2cbGhqam5tFj3xKqKbU1NT09HTRiPQE849fHRF/jRQUFHBF4IBlKSfU7u4uU/RR2gBuUUqRkZHOzs7P3K5lXMfIot90fedI+E+AAQD4wj0ZUR3UOwAAAABJRU5ErkJggg==","css":".alternative_timestamp {\r\n\tfont-weight: normal;\r\n\tclear:left;\r\n}\r\n\r\n.old_tumblr_done .alternative_timestamp {\r\n\t/* compatibility hack */\r\n\tmargin: -0.3em 0 0.7em;\r\n}\r\n\r\n.alternative_timestamps_preview {\r\n\tfont-style: italic;\r\n}","title":"Alternative Timestamps","description":"Adds timestamps to dashboard posts using a parsing method instead of AJAX calls. English tumblr interface only for now.","developer":"Bit Shift","version":"1.0 REV G","frame":"false","beta":"true","file":"found","server":"up","errors":false,"slow":"false"}