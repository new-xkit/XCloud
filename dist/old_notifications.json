{"id":"old_notifications","script":"//* TITLE Classic Notifications **//\r\n//* VERSION 0.6 REV B **//\r\n//* DESCRIPTION Notifications where they were **//\r\n//* DETAILS This is a very experimental extension that brings back the notifications to your blog pages (ie: www.tumblr.com/blog/xkit-extension), just the way it was before Tumblr's Activity update. Only the last 10 notifications are displayed. **//\r\n//* DEVELOPER STUDIOXENIX **//\r\n//* FRAME false **//\r\n//* BETA false **//\r\n\r\nXKit.extensions.old_notifications = new Object({\r\n\r\n\trunning: false,\r\n\tblacklisted: new Array(),\r\n\r\n\tpreferences: {\r\n\t\t\"count\": {\r\n\t\t\ttext: \"Number of Notifications to display\",\r\n\t\t\tdefault: \"c10\",\r\n\t\t\tvalue: \"c10\",\r\n\t\t\ttype: \"combo\",\r\n\t\t\tvalues: [\r\n\t\t\t\t\"5 Notifications\", \"c5\",\r\n\t\t\t\t\"10 Notifications (default)\", \"c10\",\r\n\t\t\t\t\"20 Notifications\", \"c20\"\r\n\t\t\t],\r\n\t\t}\r\n\t},\r\n\r\n\trun: function() {\r\n\t\tthis.running = true;\r\n\r\n\t\tif (document.location.href.indexOf('/new/') !== -1) { return; }\r\n\r\n\t\tif (XKit.interface.where().channel == true) {\r\n\t\t\tXKit.extensions.old_notifications.fetch();\r\n\t\t\t$(document).on('click','.notification.xkit-old-notifications', XKit.extensions.old_notifications.open_notification);\r\n\t\t}\r\n\r\n\t\tthis.max_notifications = parseInt(this.preferences.count.value.substring(1));\r\n\r\n\t},\r\n\r\n\tfetch_failed: function(err) {\r\n\r\n\t\tconsole.log(\"Can't fetch Activity page!\");\r\n\r\n\t},\r\n\r\n\topen_notification: function(e) {\r\n\r\n\t\tvar m_target = $(e.target);\r\n\r\n\t\tif ($(m_target).hasClass(\"xkit-reply-button\") === true) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar m_parent = $(m_target).parentsUntil(\".xkit-old-notifications\").parent();\r\n\t\twindow.open($(m_parent).attr('data-load-url'));\r\n\r\n\t},\r\n\r\n\talt_notification: false,\r\n\tmax_notifications: 9,\r\n\tnotification_count: 0,\r\n\r\n\trender_notification: function(obj) {\r\n\r\n\t\tif ($(obj).find(\".ui_note\").length <= 0) { return \"\"; }\r\n\r\n\t\tobj = $(obj).find(\".ui_note\");\r\n\r\n\t\tvar notification_url = $(obj).find(\".part_glass\").attr('href');\r\n\r\n\t\tvar notification_username = $(obj).attr('data-tumblelog-name');\r\n\t\tvar notification_user_url = $(obj).find(\".activity\").find(\"a\").attr('href');\r\n\t\tvar notification_avatar = $(obj).find(\".ui_avatar_link\").attr('data-avatar-url');\r\n\r\n\t\tnotification_avatar = notification_avatar.replace(\"_64.png\",\"_40.png\");\r\n\t\tnotification_avatar = notification_avatar.replace(\"_64.gif\",\"_40.gif\");\r\n\t\tnotification_avatar = notification_avatar.replace(\"_64.jpg\",\"_40.jpg\");\r\n\t\tnotification_avatar = notification_avatar.replace(\"_128.png\",\"_40.png\");\r\n\t\tnotification_avatar = notification_avatar.replace(\"_128.gif\",\"_40.gif\");\r\n\t\tnotification_avatar = notification_avatar.replace(\"_128.jpg\",\"_40.jpg\");\r\n\r\n\t\tvar summary = \"\";\r\n\t\tif ($(obj).find(\".part_main\").find(\".summary\").length > 0) {\r\n\t\t\tsummary = $(obj).find(\".part_main\").find(\".summary\").html();\r\n\t\t}\r\n\r\n\t\tvar response = \"\";\r\n\t\tif ($(obj).find(\".part_response\").length > 0) {\r\n\t\t\tresponse = $(obj).find(\".part_response\").html();\r\n\t\t}\r\n\r\n\t\tvar original_url = $(obj).find(\".ui_post_badge\").attr('href');\r\n\r\n\t\tif (typeof original_url !== \"undefined\") {\r\n\r\n\t\t\tif (typeof XKit.extensions.old_notifications !== \"undefined\") {\r\n\r\n\t\t\t\tfor (var i=0;i<XKit.extensions.old_notifications.blacklisted.length;i++) {\r\n\t\t\t\t\tif (XKit.extensions.old_notifications.blacklisted[i] == \"\") { continue; }\r\n\t\t\t\t\tif (original_url.indexOf(\"/post/\" + XKit.extensions.old_notifications.blacklisted[i]) !== -1) {\r\n\t\t\t\t\t\t// console.log(\"[Old Notifications]Blocking notification because of post \" + XKit.extensions.old_notifications.blacklisted[i]);\r\n\t\t\t\t\t\treturn \"\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar notification_preview = $(obj).find(\".ui_post_badge\").css(\"background-image\");\r\n\r\n\t\tif (notification_preview !== \"\" && typeof notification_preview !== \"undefined\") {\r\n\t\t\tnotification_preview = notification_preview.substring(4, notification_preview.length - 1);\r\n\t\t\tif (notification_preview.indexOf(\"\\\"\") !== -1) {\r\n\t\t\t\tnotification_preview = XKit.tools.replace_all(notification_preview, \"\\\"\", \"\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar is_friend = $(obj).hasClass(\"is_friend\");\r\n\t\tvar is_reblog = $(obj).hasClass(\"is_reblog\");\r\n\t\tvar is_reply = $(obj).hasClass(\"is_reply\");\r\n\t\tvar is_answer = $(obj).hasClass(\"is_answer\");\r\n\t\tvar is_like = $(obj).hasClass(\"is_like\");\r\n\t\tvar is_follow = $(obj).hasClass(\"is_follower\");\r\n\t\tvar is_mention = $(obj).hasClass(\"is_user_mention\");\r\n\r\n\t\tvar preview_frame_class = \"icon regular\";\r\n\t\tvar preview_image = notification_preview;\r\n\r\n\t\tvar is_post_regular = $(obj).find(\".ui_post_badge\").hasClass(\"regular\");\r\n\t\tvar is_post_photo = $(obj).find(\".ui_post_badge\").hasClass(\"photo\");\r\n\t\tvar is_post_chat = $(obj).find(\".ui_post_badge\").hasClass(\"conversation\");\r\n\t\tvar is_post_quote = $(obj).find(\".ui_post_badge\").hasClass(\"quote\");\r\n\t\tvar is_post_link = $(obj).find(\".ui_post_badge\").hasClass(\"link\");\r\n\t\tvar is_post_audio = $(obj).find(\".ui_post_badge\").hasClass(\"audio\");\r\n\t\tvar is_post_video = $(obj).find(\".ui_post_badge\").hasClass(\"video\");\r\n\r\n\t\tvar m_post_type_text = \"post\";\r\n\t\tif (is_post_photo) { m_post_type_text = \"photo\"; preview_frame_class = \"\"; }\r\n\t\tif (is_post_chat) { m_post_type_text = \"chat\"; preview_frame_class = \"icon chat\"; }\r\n\t\tif (is_post_quote) { m_post_type_text = \"quote\"; preview_frame_class = \"icon quote\"; }\r\n\t\tif (is_post_link) { m_post_type_text = \"link\"; preview_frame_class = \"icon link\"; }\r\n\t\tif (is_post_audio) { m_post_type_text = \"audio post\"; preview_frame_class = \"icon audio\"; }\r\n\t\tif (is_post_video) { m_post_type_text = \"video post\"; preview_frame_class = \"icon video\"; }\r\n\t\tif (is_mention) { m_post_type_text = \"in a post\"; preview_frame_class = \"icon mention\"; }\r\n\r\n\t\tvar load_url = \"\";\r\n\r\n\t\tvar additional_classes = \"\";\r\n\r\n\t\tif (XKit.extensions.old_notifications.notification_count === 0)\r\n\t\t\tadditional_classes = additional_classes + \" first_notification \";\r\n\r\n\t\tif (XKit.extensions.old_notifications.notification_count % 2 === 0)\r\n\t\t\tadditional_classes = additional_classes + \" alt \";\r\n\r\n\t\tif (response !== \"\")\r\n\t\t\tadditional_classes = additional_classes + \" with_commentary \";\r\n\r\n\t\tif (is_answer)\r\n\t\t\tadditional_classes = additional_classes + \" notification_answer \";\r\n\r\n\t\tif (is_reply)\r\n\t\t\tadditional_classes = additional_classes + \" notification_reply \";\r\n\r\n\t\tif (is_reblog)\r\n\t\t\tadditional_classes = additional_classes + \" notification_reblog \";\r\n\r\n\t\tif (is_like)\r\n\t\t\tadditional_classes = additional_classes + \" notification_like\";\r\n\r\n\t\tif (is_follow)\r\n\t\t\tadditional_classes = additional_classes + \" notification_follower\";\r\n\r\n\t\tif (is_mention)\r\n\t\t\tadditional_classes = additional_classes + \" notification_user_mention\";\r\n\r\n\t\tif (is_friend)\r\n\t\t\tadditional_classes = additional_classes + \" xkit_notification_follower_is_friend\";\r\n\r\n\t\tvar m_inner_html = \"\";\r\n\t\tvar no_preview_frame = false;\r\n\r\n\t\tif (is_follow) {\r\n\r\n\t\t\tload_url = notification_user_url;\r\n\r\n\t\t\tm_inner_html = \"<a class=\\\"username\\\" href=\\\"\" + notification_user_url + \"\\\">\" + notification_username + \"</a> started following you \";\r\n\t\t\tno_preview_frame = true;\r\n\r\n\t\t}\r\n\r\n\t\tif (is_like) {\r\n\r\n\t\t\tload_url = notification_url;\r\n\r\n\t\t\tm_inner_html = \"<a class=\\\"username\\\" href=\\\"\" + notification_user_url + \"\\\">\" + notification_username + \"</a> liked your \";\r\n\r\n\t\t\tif (summary !== \"\") {\r\n\t\t\t\tm_inner_html = m_inner_html + m_post_type_text + \"<span class=\\\"colon\\\">:</span> <em style=\\\"white-space:nowrap;\\\"><a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + summary + \"</em></a>\";\r\n\t\t\t} else {\r\n\t\t\t\tm_inner_html = m_inner_html + \"<a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + m_post_type_text + \"</a>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (is_reblog) {\r\n\r\n\t\t\tload_url = notification_url;\r\n\r\n\t\t\tm_inner_html = \"<a class=\\\"username\\\" href=\\\"\" + notification_user_url + \"\\\">\" + notification_username + \"</a> reblogged your \";\r\n\r\n\t\t\tif (summary !== \"\") {\r\n\t\t\t\tm_inner_html = m_inner_html + m_post_type_text + \"<span class=\\\"colon\\\">:</span> <em style=\\\"white-space:nowrap;\\\"><a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + summary + \"</em></a>\";\r\n\t\t\t} else {\r\n\t\t\t\tm_inner_html = m_inner_html + \"<a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + m_post_type_text + \"</a>\";\r\n\t\t\t}\r\n\r\n\t\t\tif (response !== \"\") {\r\n\t\t\t\tm_inner_html = m_inner_html + \"<span class=\\\"colon\\\">:</span>\" + response;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (is_mention) {\r\n\r\n\t\t\tload_url = notification_url;\r\n\r\n\t\t\tm_inner_html = \"<a class=\\\"username\\\" href=\\\"\" + notification_user_url + \"\\\">\" + notification_username + \"</a> mentioned you \";\r\n\r\n\t\t\tif (summary !== \"\") {\r\n\t\t\t\tm_inner_html = m_inner_html + m_post_type_text + \"<span class=\\\"colon\\\">:</span> <em style=\\\"white-space:nowrap;\\\"><a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + summary + \"</em></a>\";\r\n\t\t\t} else {\r\n\t\t\t\tm_inner_html = m_inner_html + \"<a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + m_post_type_text + \"</a>\";\r\n\t\t\t}\r\n\r\n\t\t\tif (response !== \"\") {\r\n\t\t\t\tm_inner_html = m_inner_html + \"<span class=\\\"colon\\\">:</span>\" + response;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\tif (is_reply) {\r\n\r\n\t\t\tload_url = notification_url;\r\n\r\n\t\t\tm_inner_html = \"<a class=\\\"username\\\" href=\\\"\" + notification_user_url + \"\\\">\" + notification_username + \"</a> replied to your \";\r\n\r\n\t\t\tif (summary !== \"\") {\r\n\t\t\t\tm_inner_html = m_inner_html + m_post_type_text + \"<span class=\\\"colon\\\">:</span> <em style=\\\"white-space:nowrap;\\\"><a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + summary + \"</em></a>\";\r\n\t\t\t} else {\r\n\t\t\t\tm_inner_html = m_inner_html + \"<a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + m_post_type_text + \"</a>\";\r\n\t\t\t}\r\n\r\n\t\t\tif (response !== \"\") {\r\n\t\t\t\tm_inner_html = m_inner_html + \"<span class=\\\"colon\\\">:</span>\" + response;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (is_answer) {\r\n\r\n\t\t\tload_url = notification_url;\r\n\r\n\t\t\tm_inner_html = \"<a class=\\\"username\\\" href=\\\"\" + notification_user_url + \"\\\">\" + notification_username + \"</a> answered your \";\r\n\r\n\t\t\tif (summary !== \"\") {\r\n\t\t\t\tm_inner_html = m_inner_html + m_post_type_text + \"<span class=\\\"colon\\\">:</span> <em style=\\\"white-space:nowrap;\\\"><a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + summary + \"</em></a>\";\r\n\t\t\t} else {\r\n\t\t\t\tm_inner_html = m_inner_html + \"<a class=\\\"notification_target\\\" href=\\\"\" + notification_url + \"\\\">\" + m_post_type_text + \"</a>\";\r\n\t\t\t}\r\n\r\n\t\t\tif (response !== \"\") {\r\n\t\t\t\tm_inner_html = m_inner_html + \"<span class=\\\"colon\\\">:</span>\" + response;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar preview_img_html = \"\";\r\n\r\n\t\tif (is_post_photo) {\r\n\t\t\tpreview_img_html = \"<img src=\\\"\" + preview_image + \"\\\">\";\r\n\t\t}\r\n\r\n\t\tvar m_html = \"<li data-url-original=\\\"\" + original_url + \"\\\" data-load-url=\\\"\" + load_url + \"\\\" id=\\\"xkit-old-notifications-\" + (XKit.extensions.old_notifications.notification_count + 1) + \"\\\" class=\\\"xkit-old-notifications notification \" + additional_classes + \"\\\">\" +\r\n\t\t\t\t\"<div class=\\\"notification_inner  clearfix\\\">\" +\r\n\t\t\t\t\t\"<div class=\\\"notification_sentence\\\">\" +\r\n\t\t\t\t\t\t\"<div class=\\\"hide_overflow\\\">\" +\r\n\t\t\t\t\t\t\tm_inner_html +\r\n\t\t\t\t\t\t\"</div>\" +\r\n\t\t\t\t\t\"</div>\" +\r\n\t\t\t\t\"</div>\" +\r\n\t\t\t\t\"<a target=\\\"_blank\\\" href=\\\"\" + notification_user_url + \"\\\" class=\\\"avatar_frame\\\">\" +\r\n\t\t\t\t\t\"<img alt=\\\"\\\" class=\\\"avatar\\\" src=\\\"\" + notification_avatar +\"\\\" data-src=\\\"\" + notification_avatar +\"\\\">\" +\r\n\t\t\t\t\"</a>\";\r\n\r\n\t\t\tif (!no_preview_frame) {\r\n\t\t\t\tvar m_html = m_html + \"<div class=\\\"notification_right\\\">\" +\r\n\t\t\t\t\t\"<a target=\\\"_blank\\\" class=\\\"preview_frame \" + preview_frame_class + \"\\\" href=\\\"\" + notification_url + \"\\\">\" + preview_img_html + \"</a>\" +\r\n\t\t\t\t\"</div>\";\r\n\t\t\t}\r\n\t\t\tm_html = m_html + \"</li>\";\r\n\r\n\t\tXKit.extensions.old_notifications.notification_count++;\r\n\r\n\t\treturn m_html;\r\n\r\n\t},\r\n\r\n\trender_notification_old: function(obj) {\r\n\r\n\t\tvar new_obj = $(obj);\r\n\r\n\t\tif ($(new_obj).find(\".ui_note\").length <= 0) { return \"\"; }\r\n\r\n\t\t$(new_obj).find(\".date_header\").remove();\r\n\t\t$(new_obj).find(\".part_glass\").remove();\r\n\t\t$(new_obj).find(\".part_ignore\").remove();\r\n\t\t$(new_obj).find(\".note_follow\").remove();\r\n\r\n\t\t$(new_obj).find(\".ui_avatar\").unwrap();\r\n\r\n\t\t$(new_obj).find(\".ui_avatar\").addClass(\"avatar_frame_temporary\");\r\n\t\t$(new_obj).find(\".ui_avatar\").removeClass(\"ui_avatar\");\r\n\r\n\t\t$(new_obj).find(\".ui_note\").addClass(\"notification\");\r\n\t\t$(new_obj).find(\".ui_note\").removeClass(\"ui_note\");\r\n\r\n\t\t$(new_obj).find(\".stage\").addClass(\"notification_inner clearfix\");\r\n\t\t$(new_obj).find(\".stage\").removeClass(\"stage\");\r\n\r\n\t\t$(new_obj).find(\".part_icon\").addClass(\"notification_right\");\r\n\t\t$(new_obj).find(\".part_icon\").removeClass(\"part_icon\");\r\n\r\n\t\t$(new_obj).find(\".part_activity\").addClass(\"notification_sentence\");\r\n\t\t$(new_obj).find(\".part_activity\").removeClass(\"part_activity\");\r\n\r\n\t\t$(new_obj).find(\".ui_post_badge\").addClass(\"preview_frame\");\r\n\t\t$(new_obj).find(\".ui_post_badge\").removeClass(\"ui_post_badge\");\r\n\r\n\t\t$(new_obj).find(\".part_main\").addClass(\"hide_overflow\");\r\n\t\t$(new_obj).find(\".part_main\").removeClass(\"part_main\");\r\n\r\n\t\tif ($(new_obj).find(\".preview_frame\").hasClass(\"photo\")) {\r\n\t\t\tvar m_src = $(new_obj).find(\".preview_frame\").css(\"background-image\");\r\n\t\t\t// ugly but works:\r\n\t\t\tm_src = m_src.substring(4, m_src.length - 1);\r\n\t\t\t$(new_obj).find(\".preview_frame\").append(\"<img src=\\\"\" + m_src + \"\\\">\");\r\n\t\t} else {\r\n\t\t\t$(new_obj).find(\".preview_frame\").addClass(\"icon\");\r\n\t\t}\r\n\r\n\t\t$(new_obj).find(\".activity\").find(\"a:first-child\").addClass(\"username\");\r\n\r\n\t\tif ($(new_obj).find(\".summary\").length > 0) {\r\n\t\t\t$(new_obj).find(\".activity\").after(\"<span class=\\\"colon\\\">:</span>\");\r\n\t\t}\r\n\r\n\t\t// Get avatar:\r\n\t\t$(new_obj).find(\".avatar\").addClass(\"old-avatar-div\");\r\n\t\tvar avatar_url = $(new_obj).find(\".avatar\").css(\"background-image\");\r\n\t\tavatar_url = avatar_url.substring(4, avatar_url.length - 1);\r\n\t\t$(new_obj).find(\".notification\").append(\"<a class=\\\"avatar_frame\\\"> <img class=\\\"avatar\\\" src=\\\"\" + avatar_url + \"\\\" data-src=\\\"\" + avatar_url + \"\\\"></a>\");\r\n\r\n\t\t$(new_obj).find(\".avatar_frame_temporary\").remove();\r\n\r\n\t\tif ($(new_obj).find(\".part_response\").length > 0) {\r\n\t\t\tvar m_response = $(new_obj).find(\".part_response\").html();\r\n\t\t\t$(new_obj).find(\".notification_sentence\").find(\".hide_overflow\").after(m_response);\r\n\t\t\t$(new_obj).find(\".part_response\").remove();\r\n\t\t}\r\n\t\t// first_notification -- last_notification\r\n\t\tvar additional_classes = \"\";\r\n\r\n\t\tvar m_link = $(obj).find(\".part_glass\").attr('href');\r\n\r\n\t\tif ($(new_obj).find(\".notification\").hasClass(\"is_answer\"))\r\n\t\t\tadditional_classes = additional_classes + \" notification_answer \";\r\n\r\n\t\tif ($(new_obj).find(\".notification\").hasClass(\"is_reply\"))\r\n\t\t\tadditional_classes = additional_classes + \" notification_reply \";\r\n\r\n\t\tif ($(new_obj).find(\".notification\").hasClass(\"is_reblog\"))\r\n\t\t\tadditional_classes = additional_classes + \" notification_reblog \";\r\n\r\n\t\tif ($(new_obj).find(\".notification\").hasClass(\"is_like\"))\r\n\t\t\tadditional_classes = additional_classes + \" notification_like\";\r\n\r\n\t\tif (XKit.extensions.old_notifications.alt_notification)\r\n\t\t\tadditional_classes = additional_classes + \" alt \";\r\n\r\n\t\tif (XKit.extensions.old_notifications.notification_count === 0)\r\n\t\t\tadditional_classes = additional_classes + \" first_notification \";\r\n\r\n\t\tif (XKit.extensions.old_notifications.notification_count === XKit.extensions.old_notifications.max_notifications - 1)\r\n\t\t\tadditional_classes = additional_classes + \" last_notification \";\r\n\r\n\t\tvar m_html = \"<li data-url=\\\"\" + m_link + \"\\\" class=\\\"notification by-xkit-old-notifications \" + additional_classes + \"\\\">\" + $(new_obj).html() + \"</li>\";\r\n\r\n\t\tXKit.extensions.old_notifications.alt_notification = !XKit.extensions.old_notifications.alt_notification;\r\n\r\n\t\tXKit.extensions.old_notifications.notification_count++;\r\n\t\treturn m_html;\r\n\r\n\t},\r\n\r\n\tfetch_successful: function(data) {\r\n\r\n\t\tif (XKit.installed.check(\"notificationblock\") === true) {\r\n\t\t\tXKit.console.add(\"notificationblock installed.\");\r\n\t\t\tif (typeof XKit.extensions.notificationblock !== \"undefined\") {\r\n\t\t\t\tif (XKit.extensions.notificationblock.running === true) {\r\n\t\t\t\t\tif (XKit.extensions.notificationblock.blacklisted !== \"undefined\") {\r\n\t\t\t\t\t\tXKit.extensions.old_notifications.blacklisted = XKit.extensions.notificationblock.blacklisted;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tXKit.console.add(\"notificationblock blacklist is undefined.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tXKit.console.add(\"notificationblock is not running.\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tXKit.console.add(\"notificationblock is undefined.\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar m_html = \"\";\r\n\t\t$(\".stage\", data).each(function() {\r\n\t\t\tif (XKit.extensions.old_notifications.notification_count >= XKit.extensions.old_notifications.max_notifications) { return false; }\r\n\t\t\tm_html = m_html + XKit.extensions.old_notifications.render_notification(\"<div>\" + $(this).parent()[0].outerHTML + \"</div>\");\r\n\t\t});\r\n\t\t$(\".new_post_buttons_container\").after(m_html);\r\n\t\t$(\"#xkit-old-notifications-\" + XKit.extensions.old_notifications.notification_count).addClass(\"last_notification\");\r\n\r\n\t\tif (XKit.installed.check(\"notificationblock\") === true) {\r\n\t\t\tif (typeof XKit.extensions.notificationblock !== \"undefined\") {\r\n\t\t\t\tif (XKit.extensions.notificationblock.running === true) {\r\n\t\t\t\t\tXKit.console.add(\"Found NotificationBlock, calling.\");\r\n\t\t\t\t\tXKit.extensions.notificationblock.do();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Lets see if there is sth we should be doing to these notifications.\r\n\t\tsetTimeout(function() { XKit.post_listener.check(true); }, 400);\r\n\r\n\t},\r\n\r\n\tfetch_id: \"\",\r\n\r\n\tfetch: function() {\r\n\r\n\t\tvar my_id = XKit.tools.random_string();\r\n\t\tXKit.extensions.old_notifications.fetch_id = my_id;\r\n\r\n\t\tsetTimeout(function() {\r\n\t\t\tvar to_fetch = document.location.href.replace(\"/blog/\",\"/activity/\");\r\n\t\t\tconsole.log(\"Trying to fetch \" + to_fetch);\r\n\t\t\tGM_xmlhttpRequest({\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\turl: to_fetch,\r\n\t\t\t\tonerror: function(response) {\r\n\t\t\t\t\tif (my_id !== XKit.extensions.old_notifications.fetch_id) { return; }\r\n\t\t\t\t\tXKit.extensions.old_notifications.fetch_failed();\r\n\t\t\t\t},\r\n\t\t\t\tonload: function(response) {\r\n\t\t\t\t\tif (my_id !== XKit.extensions.old_notifications.fetch_id) { return; }\r\n\t\t\t\t\tXKit.extensions.old_notifications.fetch_successful(response.responseText);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}, 300);\r\n\r\n\t},\r\n\r\n\tdestroy: function() {\r\n\t\tthis.running = false;\r\n\t\tthis.notification_count = 0;\r\n\t\tthis.alt_notification = false;\r\n\t\tthis.blacklisted = [];\r\n\t\tXKit.extensions.old_notifications.fetch_id = \"-1\";\r\n\t\t$(\".xkit-old-notifications\").remove();\r\n\t}\r\n\r\n});","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGNzdGMTE3NDA3MjA2ODExODA4MzkyMjM2MzU5MTQ4NCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3M0QxM0REMTgwNjUxMUUzQjQwNzg0MDQ5NEU0RjJCNCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3M0QxM0REMDgwNjUxMUUzQjQwNzg0MDQ5NEU0RjJCNCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAxODAxMTc0MDcyMDY4MTFBRTczREVDNEM5OEM0RTE5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY3N0YxMTc0MDcyMDY4MTE4MDgzOTIyMzYzNTkxNDg0Ii8+IDwvcmRmOkRlc2NyaXB0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","title":"Classic Notifications","description":"Notifications where they were","developer":"STUDIOXENIX","version":"0.6 REV B","frame":"false","beta":"false","details":"This is a very experimental extension that brings back the notifications to your blog pages (ie: www.tumblr.com/blog/xkit-extension), just the way it was before Tumblr's Activity update. Only the last 10 notifications are displayed.","file":"found","server":"up","errors":false,"slow":"false"}